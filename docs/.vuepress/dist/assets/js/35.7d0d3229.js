(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{401:function(v,_,a){"use strict";a.r(_);var s=a(45),e=Object(s.a)({},(function(){var v=this,_=v.$createElement,a=v._self._c||_;return a("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[a("h1",{attrs:{id:"分布式session一致性"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#分布式session一致性"}},[v._v("#")]),v._v(" 分布式SESSION一致性")]),v._v(" "),a("p",[a("code",[v._v("SESSION")]),v._v("是服务器为客户端创建的一个会话，存储用户的相关信息，用以标识用户身份等。在单服务器环境下是不需要考虑会话的一致性的问题的，但是在集群环境下就会出现一些问题，假如一个用户在登录请求时负载均衡到了"),a("code",[v._v("A")]),v._v("服务器，"),a("code",[v._v("A")]),v._v("服务器为其分配了"),a("code",[v._v("SESSION")]),v._v("，下次请求数据时被分配到了"),a("code",[v._v("B")]),v._v("服务器，此时由于"),a("code",[v._v("B")]),v._v("服务器不存在此用户的"),a("code",[v._v("SESSION")]),v._v("，此用户会被重定向到登录页面，这种情况是不合理的业务逻辑，所以需要维护"),a("code",[v._v("SESSION")]),v._v("的一致性。")]),v._v(" "),a("h2",{attrs:{id:"解决方案"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方案"}},[v._v("#")]),v._v(" 解决方案")]),v._v(" "),a("h3",{attrs:{id:"session-同步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#session-同步"}},[v._v("#")]),v._v(" SESSION 同步")]),v._v(" "),a("p",[v._v("多个服务器之间互相同步"),a("code",[v._v("SESSION")]),v._v("，即"),a("code",[v._v("A")]),v._v("服务器生成一个"),a("code",[v._v("SESSION")]),v._v("信息后同步传输到"),a("code",[v._v("B")]),v._v("、"),a("code",[v._v("C")]),v._v("、"),a("code",[v._v("D")]),v._v("等服务器，同样"),a("code",[v._v("B")]),v._v("、"),a("code",[v._v("C")]),v._v("、"),a("code",[v._v("D")]),v._v("服务器生成"),a("code",[v._v("SESSION")]),v._v("信息后也需要同步到"),a("code",[v._v("A")]),v._v("，这样每个服务器之间都包含全部的"),a("code",[v._v("SESSION")])]),v._v(" "),a("h4",{attrs:{id:"优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优点"}},[v._v("#")]),v._v(" 优点")]),v._v(" "),a("ul",[a("li",[v._v("大部分应用服务器都提供了"),a("code",[v._v("SESSION")]),v._v("复制的功能来实现集群")])]),v._v(" "),a("h4",{attrs:{id:"缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[v._v("#")]),v._v(" 缺点")]),v._v(" "),a("ul",[a("li",[a("code",[v._v("SESSION")]),v._v("需要网络传输进行同步，其会占用带宽，并且存在一定的延迟")]),v._v(" "),a("li",[v._v("一旦某台机器的"),a("code",[v._v("SESSION")]),v._v("信息有所变化，必须同步更新所有服务器"),a("code",[v._v("SESSION")]),v._v("内容")]),v._v(" "),a("li",[v._v("每个服务器都会存储全部的用户信息，性能随着服务器增加急剧下降，而且容易引起广播风暴")])]),v._v(" "),a("h3",{attrs:{id:"session-映射"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#session-映射"}},[v._v("#")]),v._v(" SESSION 映射")]),v._v(" "),a("p",[v._v("通过将负载均衡服务器进行修改，通过对返回给用户的"),a("code",[v._v("SESSION ID")]),v._v("或者用户请求的"),a("code",[v._v("IP")]),v._v("地址进行标记，也就是使用第四层传输层中读取网络层的"),a("code",[v._v("IP")]),v._v("或者是在第七层中读取"),a("code",[v._v("HTTP")]),v._v("协议中某些属性来做"),a("code",[v._v("HASH")]),v._v("，保证对于此用户的请求全部落到同一台服务器上")]),v._v(" "),a("h4",{attrs:{id:"优点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优点-2"}},[v._v("#")]),v._v(" 优点")]),v._v(" "),a("ul",[a("li",[v._v("实现相对简单")]),v._v(" "),a("li",[v._v("只要分配服务器时均匀，则多台服务器是负载均衡的")])]),v._v(" "),a("h4",{attrs:{id:"缺点-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点-2"}},[v._v("#")]),v._v(" 缺点")]),v._v(" "),a("ul",[a("li",[v._v("一旦某台服务器宕机，则会影响落在此服务器请求上的全部用户")]),v._v(" "),a("li",[v._v("负载均衡服务器变为了一个有状态的节点，内存消耗会更大，容灾更麻烦")])]),v._v(" "),a("h3",{attrs:{id:"客户端存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#客户端存储"}},[v._v("#")]),v._v(" 客户端存储")]),v._v(" "),a("p",[v._v("将数据直接存储到客户端比如"),a("code",[v._v("Cookie")]),v._v("或请求头中，每次请求客户端自动携带数据信息")]),v._v(" "),a("h4",{attrs:{id:"优点-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优点-3"}},[v._v("#")]),v._v(" 优点")]),v._v(" "),a("ul",[a("li",[v._v("简单，高效")]),v._v(" "),a("li",[v._v("服务端不需要储存标记用户信息")])]),v._v(" "),a("h4",{attrs:{id:"缺点-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点-3"}},[v._v("#")]),v._v(" 缺点")]),v._v(" "),a("ul",[a("li",[v._v("安全性较差，对于敏感信息必须加密")]),v._v(" "),a("li",[v._v("每次请求可能携带大量数据，占用外网带宽")]),v._v(" "),a("li",[v._v("数据存储在客户端就会存在泄密、篡改、窃取等隐患")])]),v._v(" "),a("h3",{attrs:{id:"后端集中存储"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后端集中存储"}},[v._v("#")]),v._v(" 后端集中存储")]),v._v(" "),a("p",[v._v("将"),a("code",[v._v("SESSION")]),v._v("存储在一台单独的服务器中的数据库中，例如"),a("code",[v._v("Mysql")]),v._v("、"),a("code",[v._v("Oracle")]),v._v("、"),a("code",[v._v("SqlServer")]),v._v("、"),a("code",[v._v("Redis")]),v._v("、"),a("code",[v._v("Mongodb")]),v._v("等等，各"),a("code",[v._v("SERVER")]),v._v("服务器需要用户信息时携带"),a("code",[v._v("SESSION ID")]),v._v("对于集中存储服务器进行请求，进而获取用户信息")]),v._v(" "),a("h4",{attrs:{id:"优点-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#优点-4"}},[v._v("#")]),v._v(" 优点")]),v._v(" "),a("ul",[a("li",[v._v("没有安全隐患")]),v._v(" "),a("li",[v._v("可以方便的水平拓展")]),v._v(" "),a("li",[a("code",[v._v("SERVER")]),v._v("服务器重启不会造成"),a("code",[v._v("SESSION")]),v._v("丢失")])]),v._v(" "),a("h4",{attrs:{id:"缺点-4"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缺点-4"}},[v._v("#")]),v._v(" 缺点")]),v._v(" "),a("ul",[a("li",[v._v("每次请求都增加了一次对于存储服务器的网络请求")]),v._v(" "),a("li",[v._v("会对集中存储服务器存在大量请求，数据库压力比较大")])]),v._v(" "),a("h2",{attrs:{id:"每日一题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#每日一题"}},[v._v("#")]),v._v(" 每日一题")]),v._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[v._v("https://github.com/WindrunnerMax/EveryDay\n")])]),v._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[v._v("1")]),a("br")])]),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[v._v("#")]),v._v(" 参考")]),v._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[v._v("https://www.jianshu.com/p/5caed857dc3e\nhttps://www.cnblogs.com/study-everyday/p/7853145.html\n")])]),v._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[v._v("1")]),a("br"),a("span",{staticClass:"line-number"},[v._v("2")]),a("br")])])])}),[],!1,null,null,null);_.default=e.exports}}]);