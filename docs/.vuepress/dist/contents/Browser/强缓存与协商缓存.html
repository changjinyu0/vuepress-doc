<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>强缓存与协商缓存 | 前端装逼大全</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="Just playing around">
    
    <link rel="preload" href="/vuepress-doc/assets/css/0.styles.f371e5c0.css" as="style"><link rel="preload" href="/vuepress-doc/assets/js/app.d220e3ce.js" as="script"><link rel="preload" href="/vuepress-doc/assets/js/2.b009e2dd.js" as="script"><link rel="preload" href="/vuepress-doc/assets/js/37.f6a924cb.js" as="script"><link rel="prefetch" href="/vuepress-doc/assets/js/10.a7a43a62.js"><link rel="prefetch" href="/vuepress-doc/assets/js/11.282bfba7.js"><link rel="prefetch" href="/vuepress-doc/assets/js/12.b77e9a4a.js"><link rel="prefetch" href="/vuepress-doc/assets/js/13.a9a8dfe0.js"><link rel="prefetch" href="/vuepress-doc/assets/js/14.4cbd06a8.js"><link rel="prefetch" href="/vuepress-doc/assets/js/15.81ec05ec.js"><link rel="prefetch" href="/vuepress-doc/assets/js/16.96257072.js"><link rel="prefetch" href="/vuepress-doc/assets/js/17.94c89d60.js"><link rel="prefetch" href="/vuepress-doc/assets/js/18.c1b98250.js"><link rel="prefetch" href="/vuepress-doc/assets/js/19.8d967495.js"><link rel="prefetch" href="/vuepress-doc/assets/js/20.ffdcda55.js"><link rel="prefetch" href="/vuepress-doc/assets/js/21.984e0b3c.js"><link rel="prefetch" href="/vuepress-doc/assets/js/22.c5a47b0b.js"><link rel="prefetch" href="/vuepress-doc/assets/js/23.14e82b9f.js"><link rel="prefetch" href="/vuepress-doc/assets/js/24.e91ae311.js"><link rel="prefetch" href="/vuepress-doc/assets/js/25.a6a27549.js"><link rel="prefetch" href="/vuepress-doc/assets/js/26.b65fdf40.js"><link rel="prefetch" href="/vuepress-doc/assets/js/27.e7063c71.js"><link rel="prefetch" href="/vuepress-doc/assets/js/28.c2dfc7be.js"><link rel="prefetch" href="/vuepress-doc/assets/js/29.12ba8912.js"><link rel="prefetch" href="/vuepress-doc/assets/js/3.766a0e10.js"><link rel="prefetch" href="/vuepress-doc/assets/js/30.84fd9459.js"><link rel="prefetch" href="/vuepress-doc/assets/js/31.395aca7a.js"><link rel="prefetch" href="/vuepress-doc/assets/js/32.3730b64b.js"><link rel="prefetch" href="/vuepress-doc/assets/js/33.4b7016fc.js"><link rel="prefetch" href="/vuepress-doc/assets/js/34.62471da1.js"><link rel="prefetch" href="/vuepress-doc/assets/js/35.2dedf031.js"><link rel="prefetch" href="/vuepress-doc/assets/js/36.2bedf6ed.js"><link rel="prefetch" href="/vuepress-doc/assets/js/38.9df218ee.js"><link rel="prefetch" href="/vuepress-doc/assets/js/39.1c0d6120.js"><link rel="prefetch" href="/vuepress-doc/assets/js/4.7adb1798.js"><link rel="prefetch" href="/vuepress-doc/assets/js/40.3f94f99c.js"><link rel="prefetch" href="/vuepress-doc/assets/js/41.9663fc40.js"><link rel="prefetch" href="/vuepress-doc/assets/js/42.9f1f5516.js"><link rel="prefetch" href="/vuepress-doc/assets/js/43.cc946881.js"><link rel="prefetch" href="/vuepress-doc/assets/js/44.29007527.js"><link rel="prefetch" href="/vuepress-doc/assets/js/45.92a137ac.js"><link rel="prefetch" href="/vuepress-doc/assets/js/5.d3359473.js"><link rel="prefetch" href="/vuepress-doc/assets/js/6.5eff19f1.js"><link rel="prefetch" href="/vuepress-doc/assets/js/7.d85e0952.js"><link rel="prefetch" href="/vuepress-doc/assets/js/8.13134f33.js"><link rel="prefetch" href="/vuepress-doc/assets/js/9.a841ca98.js">
    <link rel="stylesheet" href="/vuepress-doc/assets/css/0.styles.f371e5c0.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-doc/" class="home-link router-link-active"><!----> <span class="site-name">前端装逼大全</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/vuepress-doc/contents/Browser/对称加密与非对称加密.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/vuepress-doc/contents/Browser/对称加密与非对称加密.html" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/changjinyu0/vuepress-doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/vuepress-doc/contents/Browser/对称加密与非对称加密.html" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/vuepress-doc/contents/Browser/对称加密与非对称加密.html" class="nav-link">
  Guide
</a></div><div class="nav-item"><a href="https://github.com/changjinyu0/vuepress-doc" target="_blank" rel="noopener noreferrer" class="nav-link external">
  External
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Browser</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/vuepress-doc/contents/Browser/对称加密与非对称加密.html" class="sidebar-link">对称加密与非对称加密</a></li><li><a href="/vuepress-doc/contents/Browser/分布式SESSION一致性.html" class="sidebar-link">分布式SESSION一致性</a></li><li><a href="/vuepress-doc/contents/Browser/跨域问题.html" class="sidebar-link">跨域问题</a></li><li><a href="/vuepress-doc/contents/Browser/浏览器本地存储方案.html" class="sidebar-link">浏览器本地存储方案</a></li><li><a href="/vuepress-doc/contents/Browser/浏览器窗口间通信.html" class="sidebar-link">浏览器窗口间通信</a></li><li><a href="/vuepress-doc/contents/Browser/浏览器事件.html" class="sidebar-link">浏览器事件</a></li><li><a href="/vuepress-doc/contents/Browser/浏览器渲染与内核.html" class="sidebar-link">浏览器渲染与内核</a></li><li><a href="/vuepress-doc/contents/Browser/浏览器页面呈现过程.html" class="sidebar-link">浏览器页面呈现过程</a></li><li><a href="/vuepress-doc/contents/Browser/浏览器重绘与回流.html" class="sidebar-link">浏览器重绘与回流</a></li><li><a href="/vuepress-doc/contents/Browser/强缓存与协商缓存.html" class="active sidebar-link">强缓存与协商缓存</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/vuepress-doc/contents/Browser/强缓存与协商缓存.html#描述" class="sidebar-link">描述</a></li><li class="sidebar-sub-header"><a href="/vuepress-doc/contents/Browser/强缓存与协商缓存.html#强缓存" class="sidebar-link">强缓存</a></li><li class="sidebar-sub-header"><a href="/vuepress-doc/contents/Browser/强缓存与协商缓存.html#协商缓存" class="sidebar-link">协商缓存</a></li><li class="sidebar-sub-header"><a href="/vuepress-doc/contents/Browser/强缓存与协商缓存.html#每日一题" class="sidebar-link">每日一题</a></li><li class="sidebar-sub-header"><a href="/vuepress-doc/contents/Browser/强缓存与协商缓存.html#参考" class="sidebar-link">参考</a></li></ul></li><li><a href="/vuepress-doc/contents/Browser/微信小程序实现原理.html" class="sidebar-link">微信小程序实现原理</a></li><li><a href="/vuepress-doc/contents/Browser/CDN缓存的理解.html" class="sidebar-link">CDN缓存的理解</a></li><li><a href="/vuepress-doc/contents/Browser/CSRF跨站请求伪造.html" class="sidebar-link">CSRF跨站请求伪造</a></li><li><a href="/vuepress-doc/contents/Browser/CSS劫持攻击.html" class="sidebar-link">CSS劫持攻击</a></li><li><a href="/vuepress-doc/contents/Browser/DNS解析过程.html" class="sidebar-link">DNS解析过程</a></li><li><a href="/vuepress-doc/contents/Browser/Document对象.html" class="sidebar-link">Document对象</a></li><li><a href="/vuepress-doc/contents/Browser/domReady的理解.html" class="sidebar-link">domReady的理解</a></li><li><a href="/vuepress-doc/contents/Browser/Element对象.html" class="sidebar-link">Element对象</a></li><li><a href="/vuepress-doc/contents/Browser/Event对象.html" class="sidebar-link">Event对象</a></li><li><a href="/vuepress-doc/contents/Browser/GET和POST的区别.html" class="sidebar-link">GET和POST的区别</a></li><li><a href="/vuepress-doc/contents/Browser/History对象.html" class="sidebar-link">History对象</a></li><li><a href="/vuepress-doc/contents/Browser/HTMLElement对象.html" class="sidebar-link">HTMLElement对象</a></li><li><a href="/vuepress-doc/contents/Browser/HTTP协议发展历程.html" class="sidebar-link">HTTP协议发展历程</a></li><li><a href="/vuepress-doc/contents/Browser/HTTP协议概述.html" class="sidebar-link">HTTP协议概述</a></li><li><a href="/vuepress-doc/contents/Browser/HTTPS加密传输过程.html" class="sidebar-link">HTTPS加密传输过程</a></li><li><a href="/vuepress-doc/contents/Browser/Location对象.html" class="sidebar-link">Location对象</a></li><li><a href="/vuepress-doc/contents/Browser/Navigator对象.html" class="sidebar-link">Navigator对象</a></li><li><a href="/vuepress-doc/contents/Browser/OAUTH开放授权.html" class="sidebar-link">OAUTH开放授权</a></li><li><a href="/vuepress-doc/contents/Browser/OSI七层模型.html" class="sidebar-link">OSI七层模型</a></li><li><a href="/vuepress-doc/contents/Browser/RESTful架构与RPC架构.html" class="sidebar-link">RESTful架构与RPC架构</a></li><li><a href="/vuepress-doc/contents/Browser/SQL注入.html" class="sidebar-link">SQL注入</a></li><li><a href="/vuepress-doc/contents/Browser/SSO单点登录.html" class="sidebar-link">SSO单点登录</a></li><li><a href="/vuepress-doc/contents/Browser/SSRF服务器端请求伪造.html" class="sidebar-link">SSRF服务器端请求伪造</a></li><li><a href="/vuepress-doc/contents/Browser/TCP三次握手.html" class="sidebar-link">TCP三次握手</a></li><li><a href="/vuepress-doc/contents/Browser/TCP与UDP异同.html" class="sidebar-link">TCP与UDP异同</a></li><li><a href="/vuepress-doc/contents/Browser/Window对象.html" class="sidebar-link">Window对象</a></li><li><a href="/vuepress-doc/contents/Browser/XSS跨站脚本攻击.html" class="sidebar-link">XSS跨站脚本攻击</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="强缓存与协商缓存"><a href="#强缓存与协商缓存" class="header-anchor">#</a> 强缓存与协商缓存</h1> <p>浏览器缓存是浏览器在本地磁盘对用户最近请求过的资源进行存储，当访问者再次访问同一资源时，浏览器就可以直接从本地磁盘加载资源，通过缓存的方式就可以减少与服务器的数据传输，减少服务器的负担，加快页面响应速度等。</p> <h2 id="描述"><a href="#描述" class="header-anchor">#</a> 描述</h2> <p>良好的缓存策略可以降低资源的重复加载提高网页的整体加载速度，通常浏览器缓存策略分为强缓存和协商缓存。常见的<code>HTTP</code>缓存只能存储<code>GET</code>响应，对于其他类型的响应则不会进行缓存。<br>
理论上来讲，当一个资源被缓存存储后，该资源应该可以被永久存储在缓存中，由于缓存只有有限的空间用于存储资源副本，所以缓存会定期地将一些副本删除，这个过程叫做缓存驱逐。另一方面，当服务器上面的资源进行了更新，那么缓存中的对应资源也应该被更新，由于<code>HTTP</code>是<code>C/S</code>模式的协议，服务器更新一个资源时，不可能直接通知客户端更新缓存，所以双方必须为该资源约定一个过期时间，在该过期时间之前，该资源的缓存副本就是新鲜的，当过了过期时间后，该资源的缓存副本则变为陈旧的。驱逐算法用于将陈旧的资源缓存副本替换为新鲜的，注意，一个陈旧的资源缓存副本是不会直接被清除或忽略的，当客户端发起一个请求时，缓存检索到已有一个对应的陈旧资源缓存副本，则缓存会先将此请求附加一个<code>If-None-Match</code>头，然后发给目标服务器，以此来检查该资源副本是否是依然还是算新鲜的，若服务器返回了<code>304 (Not Modified)</code>，则表示此资源副本是新鲜的，注意该响应不会有带有实体信息，通过这种方式，可以节省一些带宽。若服务器通过<code>If-None-Match</code>或<code>If-Modified-Since</code>判断后发现已过期，那么会带有该资源的实体内容返回。对上面的请求过程可以概括如下：</p> <ul><li>浏览器在发起对于资源的请求时，会首先检查本地是否存在缓存，如果存在缓存则通过<code>expires</code>和<code>cache-control</code>检查缓存是否过期，如果命中缓存且缓存未过期，则直接使用本地缓存。</li> <li>本地缓存未命中，则浏览器向服务器发送一个协商请求，通过<code>last-modified</code>和<code>etag</code>验证资源是否命中协商缓存，如果命中则服务器会将这个请求响应为<code>304</code>，但是不会返回这个资源的数据，依然是从缓存中读取资源，如果未命中则会携带资源返回且响应为<code>200</code>。</li></ul> <h2 id="强缓存"><a href="#强缓存" class="header-anchor">#</a> 强缓存</h2> <p>强缓存是通过<code>Expires</code>与<code>Cache-Control</code>来控制缓存在本地的有效期。</p> <h3 id="expires"><a href="#expires" class="header-anchor">#</a> Expires</h3> <p><code>Expires</code>是<code>HTTP 1.0</code>提出的一个表示资源过期时间的<code>Header</code>，它描述的是一个绝对时间，由服务器返回。<code>Expires</code>受限于本地时间，如果修改了本地时间，可能会造成缓存失效.对于资源的请求，如果在<code>Expires</code>之内，则浏览器会直接读取缓存，不再请求服务器。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Expires: Sun, 14 Jun 2020 02:50:57 GMT
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="cache-control"><a href="#cache-control" class="header-anchor">#</a> Cache-Control</h3> <p><code>Cache-Control</code>出现于<code>HTTP 1.1</code>，优先级高于<code>Expires</code>，表示的是相对时间，请求头和响应头都支持这个属性，通过它提供的不同的值来定义缓存策略。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>Cache-Control: max-age=300
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>Cache-Control: no-store</code>: 缓存中不得存储任何关于客户端请求和服务端响应的内容，每次由客户端发起的请求都会下载完整的响应内容。</li> <li><code>Cache-Control: no-cache</code>: 缓存中会存储服务端响应的内容，只是在与服务端进行新鲜度再验证之前，该缓存不能够提供给浏览器使用。简单来说，就是浏览器会将服务端响应的资源进行缓存，但是在每次请求时，缓存都要向服务端评估缓存响应的有效性，协商缓存是否可用，根据响应是<code>304</code>还是<code>200</code>判断是使用本地缓存资源还是使用服务器响应的资源。</li> <li><code>Cache-Control: public || private</code>: <code>public</code>表示该响应可以被任何中间人比如中间代理、<code>CDN</code>等缓存。默认响应为<code>private</code>，<code>private</code>表示该响应是专用的，中间人不能缓存此响应，该响应只能应用于浏览器私有缓存中。</li> <li><code>Cache-Control: max-age=31536000</code>: 响应为最大的过期时间，其指令是<code>max-age=&lt;seconds&gt;</code>，表示资源能够被缓存即保持新鲜的最大时间，<code>max-age</code>是距离请求发起的时间的秒数。</li> <li><code>Cache-Control: must-revalidate</code>: 当使用了<code>must-revalidate</code>指令，那就意味着缓存在考虑使用一个陈旧的资源时，必须先验证它的状态，已过期的缓存将不被使用。在正常情况下是没有必要使用这个指令的，因为在强缓存过期的情况下会进行协商缓存，但是<code>HTTP</code>规范是允许客户端在某些特殊情况下直接使用过期缓存的，比如校验请求发送失败的时候，还比如有配置一些特殊指令<code>stale-while-revalidate</code>、<code>stale-if-error</code>等的时候，<code>must-revalidate</code>指令就是让缓存在过期后的任何情况下都必须重新验证。</li></ul> <h2 id="协商缓存"><a href="#协商缓存" class="header-anchor">#</a> 协商缓存</h2> <p>当浏览器对某个资源的请求没有命中强缓存，就会发一个请求到服务器，验证协商缓存是否命中，如果协商缓存命中，请求响应返回的<code>HTTP</code>状态为<code>304 (Not Modified)</code>，该请求不携带实体数据，若未命中，则返回<code>200</code>并携带资源实体数据。协商缓存是利用的是<code>Last-Modified，If-Modified-Since</code>和<code>ETag、If-None-Match</code>这两对<code>Header</code>来管理的。</p> <h3 id="last-modified-if-modified-since"><a href="#last-modified-if-modified-since" class="header-anchor">#</a> Last-Modified If-Modified-Since</h3> <p><code>Last-Modified，If-Modified-Since</code>是<code>HTTP 1.0</code>引入的，<code>Last-Modified</code>表示本地文件最后修改日期，浏览器会在请求头加上<code>If-Modified-Since</code>即上次响应的<code>Last-Modified</code>的值，询问服务器在该日期后资源是否有更新，有更新的话就会将新的资源发送回来，但是如果在本地打开缓存文件，就会造成<code>Last-Modified</code>被修改，所以在<code>HTTP 1.1</code>出现了<code>ETag</code>。</p> <h3 id="etag-if-none-match"><a href="#etag-if-none-match" class="header-anchor">#</a> ETag If-None-Match</h3> <p><code>Etag</code>就像一个指纹，资源变化都会导致<code>ETag</code>变化，跟最后修改时间没有关系，<code>ETag</code>可以保证每一个资源是唯一的，<code>If-None-Match</code>的请求头字段会将上次返回的<code>Etag</code>发送给服务器，询问该资源的<code>Etag</code>是否有更新，有变动就会发送新的资源回来。<code>ETag</code>的优先级比<code>Last-Modified</code>更高，具体使用<code>ETag</code>主要出于下面几种情况考虑：</p> <ul><li>一些文件也许会周期性的更改，但是他的内容并不改变，比如仅仅改变的修改时间，这个时候我们并不希望客户端认为这个文件被修改了，而重新<code>GET</code>。</li> <li>某些文件修改非常频繁，比如在秒以下的时间内进行修改，例如<code>1s</code>内修改了<code>N</code>次，<code>If-Modified-Since</code>能检查到的粒度是秒级的，这种修改无法判断。</li> <li>某些服务器不能精确的得到文件的最后修改时间。</li></ul> <h2 id="每日一题"><a href="#每日一题" class="header-anchor">#</a> 每日一题</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>https://github.com/WindrunnerMax/EveryDay
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="参考"><a href="#参考" class="header-anchor">#</a> 参考</h2> <div class="language- line-numbers-mode"><pre class="language-text"><code>https://zhuanlan.zhihu.com/p/60357719
https://www.jianshu.com/p/9c95db596df5
https://segmentfault.com/a/1190000008956069
https://github.com/amandakelake/blog/issues/41
https://juejin.im/post/5ccfccaff265da03ab233bf5
https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Caching_FAQ
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/vuepress-doc/contents/Browser/浏览器重绘与回流.html" class="prev">
        浏览器重绘与回流
      </a></span> <span class="next"><a href="/vuepress-doc/contents/Browser/微信小程序实现原理.html">
        微信小程序实现原理
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-doc/assets/js/app.d220e3ce.js" defer></script><script src="/vuepress-doc/assets/js/2.b009e2dd.js" defer></script><script src="/vuepress-doc/assets/js/37.f6a924cb.js" defer></script>
  </body>
</html>
